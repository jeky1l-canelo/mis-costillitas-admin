<div class="gestion-usuarios-container">
  
  <h2>GestiÃ³n de Personal</h2>

  <!-- Mensajes Generales -->
  <div *ngIf="generalSuccessMessage" class="success-backend">{{ generalSuccessMessage }}</div>
  <div *ngIf="deleteSuccessMessage" class="success-backend">{{ deleteSuccessMessage }}</div>
  <div *ngIf="deleteErrorMessage" class="error-backend">{{ deleteErrorMessage }}</div>

  <!-- 
    BOTÃ“N CREAR 
    (Solo se ve si el formulario NO estÃ¡ abierto)
  -->
  <div class="actions-bar" *ngIf="!showForm">
    <button class="btn-crear" (click)="openCreateForm()">
      + Nuevo Empleado
    </button>
  </div>

  <!-- 
    ========================================
    FORMULARIO REUTILIZABLE (Hijo)
    ========================================
    Solo se muestra si showForm es true.
    [userId]: Le pasamos el ID (input).
    (onSave): Escuchamos cuando guarde (output).
    (onCancel): Escuchamos cuando cancele (output).
  -->
  <div *ngIf="showForm" class="form-wrapper">
    <app-usuario-form
      [userIdToEdit]="userIdToEdit"
      (onSave)="handleFormSaved()"
      (onCancel)="handleFormCancelled()">
    </app-usuario-form>
  </div>

  <!-- 
    TABLA DE USUARIOS 
    (Se oculta si estamos editando/creando para no saturar, opcional)
  -->
  <div class="table-responsive" *ngIf="!isLoading && !showForm">
    <table class="tabla-usuarios">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Usuario/Email</th>
          <th>Rol</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let usuario of usuarios">
          <td>{{ usuario.id }}</td>
          <td>{{ usuario.nombre }}</td>
          <td>
            {{ usuario.username }} <br>
            <small>{{ usuario.email }}</small>
          </td>
          <td>
            <span class="badge-rol">{{ usuario.rolNombre }}</span>
          </td>
          <td class="acciones-cell">
            <!-- BOTÃ“N EDITAR -->
            <button class="btn-icon btn-editar" (click)="openEditForm(usuario.id)">
              âœï¸
            </button>
            <!-- BOTÃ“N BORRAR -->
            <button class="btn-icon btn-borrar" (click)="borrarUsuario(usuario.id, usuario.nombre)">
              ğŸ—‘ï¸
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  
  <div *ngIf="isLoading" class="loading">Cargando personal...</div>

</div>