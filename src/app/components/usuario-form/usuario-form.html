<div class="usuario-form-container">
  
  <h3 class="form-title">
    {{ isEditMode ? '✏️ Editar Usuario' : '➕ Crear Nuevo Usuario' }}
  </h3>

  <div *ngIf="isLoading && isEditMode" class="loading-overlay">
    Cargando datos...
  </div>

  <form *ngIf="!isLoading || !isEditMode" (ngSubmit)="saveUser()" #userForm="ngForm">

    <!-- Username -->
    <div class="form-group">
      <label for="username">Usuario:</label>
      <input type="text" id="username" name="username" 
             [(ngModel)]="userData.username" required #username="ngModel"
             placeholder="Ej: j.perez">
      <div *ngIf="username.invalid && (username.dirty || username.touched)" class="error">
        Nombre de usuario requerido.
      </div>
    </div>

    <!-- Nombre Completo -->
    <div class="form-group">
      <label for="nombre">Nombre Completo:</label>
      <input type="text" id="nombre" name="nombre" 
             [(ngModel)]="userData.nombre" required #nombre="ngModel"
             placeholder="Ej: Juan Perez">
      <div *ngIf="nombre.invalid && (nombre.dirty || nombre.touched)" class="error">
        Nombre completo requerido.
      </div>
    </div>

    <!-- Email -->
    <div class="form-group">
      <label for="email">Email:</label>
      <input type="email" id="email" name="email" 
             [(ngModel)]="userData.email" required email #email="ngModel"
             placeholder="juan@miscostillitas.com">
      <div *ngIf="email.invalid && (email.dirty || email.touched)" class="error">
        <span *ngIf="email.errors?.['required']">Email requerido.</span>
        <span *ngIf="email.errors?.['email']">Formato inválido.</span>
      </div>
    </div>

    <!-- Password (Opcional en Edit) -->
    <div class="form-group">
      <label for="password">
        Contraseña:
        <span *ngIf="isEditMode" class="optional-text">(Dejar vacío para mantener la actual)</span>
      </label>
      <input type="password" id="password" name="password" 
             [(ngModel)]="userData.password" 
             [required]="!isEditMode" 
             minlength="6" 
             #password="ngModel">
      
      <div *ngIf="password.invalid && (password.dirty || password.touched)" class="error">
        <span *ngIf="password.errors?.['required']">Contraseña requerida.</span>
        <span *ngIf="password.errors?.['minlength']">Mínimo 6 caracteres.</span>
      </div>
    </div>

    <!-- Rol -->
    <div class="form-group">
      <label for="rol">Rol:</label>
      <select id="rol" name="rol" [(ngModel)]="userData.rolNombre" required #rol="ngModel">
        <option *ngFor="let r of roles" [value]="r">
          {{ r.replace('ROLE_', '') }}
        </option> 
      </select>
    </div>

    <!-- Mensaje de Error -->
    <div *ngIf="errorMessage" class="error-backend">
      {{ errorMessage }}
    </div>

    <!-- Botones -->
    <div class="form-buttons">
      <button type="button" (click)="cancel()" class="btn-cancel">
        Cancelar
      </button>
      
      <button type="submit" [disabled]="!userForm.form.valid || isLoading" class="btn-save">
        {{ isLoading ? 'Guardando...' : (isEditMode ? 'Actualizar' : 'Guardar') }}
      </button>
    </div>

  </form>
</div>